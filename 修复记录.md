# 系统错误修复记录

## 发现的问题

### 1. 审计日志表字段缺失 ✅ 已修复

**错误信息**:
```
Error 1054 (42S22): Unknown column 'request_body' in 'field list'
```

**原因**: `audit_logs` 表缺少 `request_body` 字段

**解决方案**:
```sql
ALTER TABLE audit_logs ADD COLUMN request_body TEXT AFTER request_method;
```

**状态**: ✅ 已修复

### 2. APP 详情 API 返回 404

**错误信息**:
```
[GIN] 2026/01/11 - 09:15:57 | 404 | GET "/api/v1/apps/1"
Error: 应用不存在
```

**原因**: 
- 前端使用数据库自增ID (1, 2, 3...) 访问 APP
- 但实际数据库中的 ID 是 26, 27, 28...
- 测试数据导入时清空了旧数据，ID 从新值开始

**影响**:
- APP 详情页面无法加载数据
- APP 配置页面显示空白信息

**解决方案**:
需要修改前端路由，使用 `app_id` 而不是数据库 ID

### 3. 审计日志页面无数据

**可能原因**:
- 数据库中有15条审计日志
- 但前端查询可能有问题
- 需要进一步检查 API 查询逻辑

## 待修复项

- [ ] 修复 APP 详情路由问题（使用 app_id 而不是数据库 ID）
- [ ] 检查审计日志查询逻辑
- [ ] 统一所有 API 使用 app_id 作为标识符

## 调试改进

### 后端

1. ✅ 启用调试模式（config.yaml: mode: debug）
2. ✅ 启用详细日志（config.yaml: log level: debug）
3. ✅ 为 API 添加调试响应头（X-Debug-*）
4. ✅ 启用 GORM Debug 模式查看 SQL 语句

### 前端

1. ✅ 创建调试工具模块（debug.js）
2. ✅ 在请求拦截器中添加调试头日志
3. ✅ 系统日志收集器已存在并正常工作
4. ✅ 可以通过 `window.__exportLogs()` 导出日志

## 数据库状态

### apps 表

当前 ID 范围: 26-30

| ID | Name | app_id | Status |
|----|------|--------|--------|
| 26 | 测试APP-电商平台 | test_app_001 | 1 |
| 27 | 测试APP-社交网络 | test_app_002 | 1 |
| 28 | 测试APP-在线教育 | test_app_003 | 1 |
| 29 | 测试APP-物流管理 | test_app_004 | 1 |
| 30 | 测试APP-金融服务 | test_app_005 | 1 |

### 审计日志

- 总数: 15条
- 表字段: 已修复，添加了 `request_body` 字段

## 下一步

1. 修改前端路由和 API 调用，统一使用 `app_id`
2. 更新 APP 列表页面的链接
3. 验证所有功能模块
4. 提交修复到 GitHub
