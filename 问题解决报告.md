# 问题解决报告

## 问题描述

用户反馈前端应用"打不开"，经诊断发现前端可以访问，但登录时提示"用户名或密码错误"。

## 根本原因

数据库中缺少 `admins` 表，而后端登录 API 需要从 `admins` 表查询管理员信息。数据库初始化脚本只创建了 `users` 表，但没有创建 `admins` 表。

## 解决方案

### 1. 创建 admins 表

```sql
CREATE TABLE IF NOT EXISTS admins (
  id bigint unsigned NOT NULL AUTO_INCREMENT,
  username varchar(50) NOT NULL,
  password varchar(255) NOT NULL,
  nickname varchar(100) DEFAULT NULL,
  avatar varchar(255) DEFAULT NULL,
  status int DEFAULT 1,
  created_at timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at timestamp NULL DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY idx_username (username),
  KEY idx_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2. 迁移管理员数据

从 `users` 表迁移管理员数据到 `admins` 表：

```sql
INSERT INTO admins (username, password, nickname, status)
SELECT username, password, username, status FROM users WHERE username = 'admin'
ON DUPLICATE KEY UPDATE password = VALUES(password);
```

### 3. 生成正确的密码哈希

原数据库中的密码哈希格式不正确，使用 Python bcrypt 生成新的密码哈希：

```python
import bcrypt
password = "admin123"
hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
# 结果: $2b$12$GWsdhwjKV/InZtsaEHFnfu228GeXw/D53OJN8mEx9B7lagnfct3k.
```

### 4. 更新管理员密码

```sql
UPDATE admins 
SET password = '$2b$12$GWsdhwjKV/InZtsaEHFnfu228GeXw/D53OJN8mEx9B7lagnfct3k.' 
WHERE username = 'admin';
```

## 验证结果

### 后端 API 测试

```bash
curl -X POST http://localhost:8080/api/v1/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**响应**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "avatar": "",
      "id": 1,
      "nickname": "admin",
      "username": "admin"
    }
  }
}
```

✅ **后端 API 测试通过**

### 前端登录测试

1. 访问前端应用：https://5173-iss2w2cv0pmr7fsbbouis-bbd116ec.sg1.manus.computer
2. 输入用户名：admin
3. 输入密码：admin123
4. 点击登录按钮
5. 成功跳转到仪表盘页面

✅ **前端登录测试通过**

## 系统状态

### 前端服务
- **状态**: ✅ 正常运行
- **地址**: https://5173-iss2w2cv0pmr7fsbbouis-bbd116ec.sg1.manus.computer
- **功能**: 登录、仪表盘显示正常

### 后端服务
- **状态**: ✅ 正常运行
- **地址**: https://8080-iss2w2cv0pmr7fsbbouis-bbd116ec.sg1.manus.computer
- **功能**: 登录 API、JWT 认证正常

### 数据库
- **状态**: ✅ 正常运行
- **表数量**: 17张（原16张 + admins表）
- **管理员账号**: admin / admin123

## 仪表盘功能

登录成功后，仪表盘显示以下内容：

1. **统计卡片**
   - APP总数: 0
   - 用户总数: 5000
   - 今日新增: 0
   - 活跃APP: 0

2. **数据图表**
   - 用户增长趋势（折线图）
   - APP使用统计（饼图）

3. **导航菜单**
   - 仪表盘
   - APP管理
   - 模块管理
   - 审计日志

4. **快捷操作**
   - 创建APP
   - APP列表
   - 系统管理

## 问题总结

| 项目 | 状态 |
|------|------|
| 前端服务 | ✅ 正常 |
| 后端服务 | ✅ 正常 |
| 数据库 | ✅ 正常 |
| 登录功能 | ✅ 正常 |
| 仪表盘 | ✅ 正常 |

**所有问题已解决，系统可以正常使用！**

## 建议

1. **更新数据库初始化脚本**：在 `database/schema.sql` 中添加 `admins` 表的创建语句
2. **文档更新**：在 README 中说明 `admins` 表和 `users` 表的区别
3. **密码安全**：提醒用户首次登录后修改默认密码
4. **数据迁移**：如果有其他环境，需要执行相同的数据库修复步骤

---

**解决时间**: 2026年1月11日  
**解决人员**: Manus AI Assistant
